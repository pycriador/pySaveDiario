{% extends "base.html" %}
{% block title %}Editar Oferta{% endblock %}

{% block content %}
<section>
  <div class="d-flex flex-wrap align-items-center justify-content-between gap-3 mb-4">
    <div>
      <p class="eyebrow"><i class="bi bi-pencil-square"></i> Editar Oferta</p>
      <h1 class="mb-0">Atualizar Dados</h1>
      <p class="muted mb-0">Modifique os dados da oferta conforme necessário</p>
    </div>
    <a href="{{ url_for('web.offers') }}" class="btn btn-outline-light btn-sm">
      <i class="bi bi-arrow-left"></i> Voltar para Lista
    </a>
  </div>

  <div class="panel">
    <form method="post" enctype="multipart/form-data" class="row g-4">
      {{ form.hidden_tag() }}
      
      <!-- Product Section -->
      <div class="col-12">
        <h5 class="text-uppercase text-muted mb-3" style="font-size: 0.85rem; letter-spacing: 0.1em; border-bottom: 1px solid var(--border-color); padding-bottom: 0.5rem;">
          <i class="bi bi-box"></i> Informações do Produto
        </h5>
      </div>
      
      <div class="col-md-6">
        <label class="form-label" for="{{ form.product_name.id }}">
          <i class="bi bi-box-seam"></i> Nome do produto *
        </label>
        {{ form.product_name(class="form-control", placeholder="Ex: iPhone 15 Pro Max", required=True) }}
      </div>
      
      <div class="col-md-6">
        <label class="form-label" for="{{ form.product_slug.id }}">
          <i class="bi bi-link-45deg"></i> Slug do produto *
        </label>
        {{ form.product_slug(class="form-control", placeholder="iphone-15-pro-max", required=True) }}
      </div>
      
      <div class="col-12">
        <label class="form-label" for="{{ form.product_description.id }}">
          <i class="bi bi-text-paragraph"></i> Descrição do produto
        </label>
        {{ form.product_description(class="form-control html-editor", id="product_description", rows="3", placeholder="Descrição detalhada do produto com formatação HTML...") }}
      </div>
      
      <!-- Separator -->
      <div class="col-12 my-4">
        <hr style="border-top: 2px solid var(--border-color); opacity: 0.3;">
      </div>
      
      <div class="col-12">
        <label class="form-label" for="{{ form.product_image.id }}">
          <i class="bi bi-image"></i> Imagem do produto
        </label>
        {% if offer.product and offer.product.image_url %}
        <div class="mb-2">
          <img src="{{ offer.product.image_url }}" alt="Imagem atual" class="img-thumbnail" style="max-height: 150px;">
          <small class="text-muted d-block">Imagem atual - envie uma nova para substituir</small>
        </div>
        {% endif %}
        {{ form.product_image(class="form-control", accept="image/png,image/jpeg,image/jpg,image/gif,image/webp") }}
        <small class="text-muted">
          <i class="bi bi-info-circle"></i> Formatos permitidos: PNG, JPG, JPEG, GIF, WEBP. Tamanho máximo: 5MB
        </small>
      </div>
      
      <!-- Classificação do Produto -->
      <div class="col-12 mt-4">
        <h5 class="text-uppercase text-muted mb-3" style="font-size: 0.85rem; letter-spacing: 0.1em; border-bottom: 1px solid var(--border-color); padding-bottom: 0.5rem;">
          <i class="bi bi-tag"></i> Classificação
        </h5>
      </div>
      
      <div class="col-md-4">
        <label class="form-label">
          <i class="bi bi-tag"></i> Categoria
        </label>
        {{ form.category_id(class="form-select", id="category_id") }}
      </div>
      
      <div class="col-md-4">
        <label class="form-label">
          <i class="bi bi-building"></i> Fabricante
        </label>
        {{ form.manufacturer_id(class="form-select", id="manufacturer_id") }}
      </div>
      
      <div class="col-md-4">
        <label class="form-label">
          <i class="bi bi-shop"></i> Vendedor
        </label>
        {{ form.seller_id(class="form-select", id="seller_id") }}
      </div>
      
      <!-- Preços -->
      <div class="col-12 mt-4">
        <h5 class="text-uppercase text-muted mb-3" style="font-size: 0.85rem; letter-spacing: 0.1em; border-bottom: 1px solid var(--border-color); padding-bottom: 0.5rem;">
          <i class="bi bi-cash"></i> Preços
        </h5>
      </div>
      
      <div class="col-md-4">
        <label class="form-label" for="{{ form.price.id }}">
          <i class="bi bi-cash"></i> Preço Atual *
        </label>
        {{ form.price(class="form-control", placeholder="0.00", required=True, step="0.01") }}
      </div>
      
      <div class="col-md-4">
        <label class="form-label" for="{{ form.old_price.id }}">
          <i class="bi bi-cash-stack"></i> Preço Antigo
        </label>
        {{ form.old_price(class="form-control", placeholder="0.00", step="0.01") }}
        <small class="text-muted">
          <i class="bi bi-info-circle"></i> Opcional - Para mostrar desconto
        </small>
      </div>
      
      <div class="col-md-4">
        <label class="form-label" for="{{ form.currency.id }}">
          <i class="bi bi-currency-exchange"></i> Moeda
        </label>
        {{ form.currency(class="form-select", id="currency") }}
      </div>
      
      <!-- Parcelamento -->
      <div class="col-12 mt-4">
        <h5 class="text-uppercase text-muted mb-3" style="font-size: 0.85rem; letter-spacing: 0.1em; border-bottom: 1px solid var(--border-color); padding-bottom: 0.5rem;">
          <i class="bi bi-credit-card"></i> Parcelamento (Opcional)
        </h5>
      </div>
      
      <div class="col-md-4">
        <label class="form-label" for="{{ form.installment_count.id }}">
          <i class="bi bi-123"></i> Quantidade de Parcelas
        </label>
        {{ form.installment_count(class="form-control", placeholder="Ex: 5", min="1", max="99") }}
        <small class="text-muted">
          <i class="bi bi-info-circle"></i> Em quantas vezes
        </small>
      </div>
      
      <div class="col-md-4">
        <label class="form-label" for="{{ form.installment_value.id }}">
          <i class="bi bi-cash-coin"></i> Valor da Parcela
        </label>
        {{ form.installment_value(class="form-control", placeholder="Ex: 72.00", step="0.01") }}
        <small class="text-muted">
          <i class="bi bi-info-circle"></i> Valor de cada parcela
        </small>
      </div>
      
      <div class="col-md-4">
        <label class="form-label" for="{{ form.installment_interest_free.id }}">
          <i class="bi bi-percent"></i> Juros
        </label>
        <div class="form-check form-switch pt-2">
          {{ form.installment_interest_free(class="form-check-input", id="installment_interest_free") }}
          <label class="form-check-label" for="installment_interest_free">
            Sem juros
          </label>
        </div>
        <small class="text-muted">
          <i class="bi bi-info-circle"></i> Marque se for sem juros
        </small>
      </div>
      
      <!-- Validade -->
      <div class="col-12 mt-4">
        <h5 class="text-uppercase text-muted mb-3" style="font-size: 0.85rem; letter-spacing: 0.1em; border-bottom: 1px solid var(--border-color); padding-bottom: 0.5rem;">
          <i class="bi bi-link"></i> Link e Validade
        </h5>
      </div>
      
      <div class="col-md-12">
        <label class="form-label" for="{{ form.offer_url.id }}">
          <i class="bi bi-link"></i> URL da oferta
        </label>
        {{ form.offer_url(class="form-control", placeholder="https://...") }}
      </div>
      
      <div class="col-md-6">
        <label class="form-label" for="{{ form.expires_date.id }}">
          <i class="bi bi-calendar-event"></i> Data de expiração
        </label>
        {{ form.expires_date(class="form-control") }}
        <small class="text-muted">
          <i class="bi bi-info-circle"></i>
          Data (opcional)
        </small>
      </div>
      
      <div class="col-md-6">
        <label class="form-label" for="{{ form.expires_time.id }}">
          <i class="bi bi-clock"></i> Hora de expiração
        </label>
        {{ form.expires_time(class="form-control") }}
        <small class="text-muted">
          <i class="bi bi-info-circle"></i>
          Hora (opcional)
        </small>
      </div>
      
      <div class="col-12 mt-4">
        <hr>
        <div class="d-flex justify-content-between align-items-center">
          <button type="button" class="btn btn-outline-secondary" onclick="window.history.back()">
            <i class="bi bi-x-circle"></i> Cancelar
          </button>
          <button type="submit" class="btn btn-primary btn-lg">
            <i class="bi bi-check-circle"></i> Atualizar Oferta
          </button>
        </div>
      </div>
    </form>
  </div>
</section>

{% endblock %}

{% block scripts %}
<!-- HTML Editor Component -->
{% include 'components/html_editor.html' %}
{% endblock %}

