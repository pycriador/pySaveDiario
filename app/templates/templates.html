{% extends "base.html" %}
{% block title %}Templates de Compartilhamento{% endblock %}

{% block content %}
<section>
  <div class="d-flex flex-wrap align-items-center justify-content-between gap-3 mb-4">
    <div>
      <p class="eyebrow"><i class="bi bi-file-earmark-richtext-fill"></i> Playbook social</p>
      <h1 class="mb-0">Templates disponíveis</h1>
      <p class="muted mb-0">Padronize posts e compartilhe com um clique.</p>
    </div>
    <div class="d-flex gap-2">
      <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#createTemplateModal">
        <i class="bi bi-plus-circle-fill"></i> Novo template
      </button>
      <a class="btn btn-outline-light btn-sm" href="{{ url_for('web.dashboard') }}">
        <i class="bi bi-arrow-left"></i> Voltar ao painel
      </a>
    </div>
  </div>

  <div class="grid two">
    {% for template in templates %}
    <article class="panel card">
      <div class="d-flex justify-content-between align-items-start mb-3">
        <div>
          <h3>
            <i class="bi bi-file-earmark-text-fill"></i>
            {{ template.name }}
          </h3>
          <p class="muted">{{ template.description or "Sem descrição." }}</p>
        </div>
        <span class="badge bg-primary bg-opacity-25 text-white">
          <i class="bi bi-share"></i> {{ template.channel_list|length }} canais
        </span>
      </div>
      
      <div class="mb-3">
        <small class="text-uppercase text-muted d-block mb-2" style="font-size: 0.7rem; letter-spacing: 0.1em;">
          <i class="bi bi-broadcast"></i> Canais disponíveis
        </small>
        <div class="d-flex flex-wrap gap-2">
          {% for channel in template.channel_list %}
          <span class="tag">
            {% if channel == 'instagram' %}
            <i class="bi bi-instagram"></i>
            {% elif channel == 'facebook' %}
            <i class="bi bi-facebook"></i>
            {% elif channel == 'whatsapp' %}
            <i class="bi bi-whatsapp"></i>
            {% elif channel == 'telegram' %}
            <i class="bi bi-telegram"></i>
            {% elif channel == 'twitter' %}
            <i class="bi bi-twitter-x"></i>
            {% else %}
            <i class="bi bi-share"></i>
            {% endif %}
            {{ channel }}
          </span>
          {% endfor %}
        </div>
      </div>
      
      <div class="mt-3">
        <small class="text-uppercase text-muted d-block mb-2" style="font-size: 0.7rem; letter-spacing: 0.1em;">
          <i class="bi bi-code-square"></i> Corpo do template
        </small>
        <pre>{{ template.body }}</pre>
      </div>
    </article>
    {% else %}
    <div class="col-12">
      <div class="panel text-center py-5">
        <i class="bi bi-file-earmark-x" style="font-size: 3rem; color: var(--text-muted);"></i>
        <p class="mt-3 muted">Nenhum template cadastrado no momento.</p>
      </div>
    </div>
    {% endfor %}
  </div>
</section>

<!-- Modal: Criar Novo Template -->
<div class="modal fade" id="createTemplateModal" tabindex="-1" aria-labelledby="createTemplateModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="createTemplateModalLabel">
          <i class="bi bi-plus-circle-fill"></i> Novo template
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
      </div>
      <div class="modal-body">
        <p class="muted mb-3">Escolha canais e defina o corpo que será usado nas publicações.</p>
        <form method="post" id="createTemplateForm" class="row g-3">
          {{ form.hidden_tag() }}
          <div class="col-md-6">
            <label class="form-label" for="{{ form.name.id }}">
              <i class="bi bi-file-text"></i> Nome
            </label>
            {{ form.name(class="form-control", placeholder="Nome do template") }}
          </div>
          <div class="col-md-6">
            <label class="form-label" for="{{ form.slug.id }}">
              <i class="bi bi-link-45deg"></i> Slug
            </label>
            {{ form.slug(class="form-control", placeholder="template-slug") }}
          </div>
          <div class="col-12">
            <label class="form-label" for="{{ form.description.id }}">
              <i class="bi bi-text-paragraph"></i> Descrição
            </label>
            {{ form.description(class="form-control", rows="2", placeholder="Descrição do template") }}
          </div>
          <div class="col-12">
            <label class="form-label" for="{{ form.channels.id }}">
              <i class="bi bi-broadcast"></i> Canais
            </label>
            {{ form.channels(class="form-control", placeholder="instagram, facebook, whatsapp, telegram") }}
            <small class="muted d-flex align-items-center gap-1 mt-1">
              <i class="bi bi-info-circle"></i>
              Separe por vírgula (ex: instagram, facebook, whatsapp).
            </small>
          </div>
          <div class="col-12">
            <label class="form-label" for="{{ form.body.id }}">
              <i class="bi bi-code-square"></i> Corpo do template
            </label>
            {{ form.body(class="form-control", rows="6", placeholder="Conteúdo que será usado nas publicações...") }}
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
          <i class="bi bi-x-circle"></i> Cancelar
        </button>
        <button type="submit" form="createTemplateForm" class="btn btn-primary">
          <i class="bi bi-check-circle"></i> Criar template
        </button>
      </div>
    </div>
  </div>
</div>
{% endblock %}
